
> codex-session-viewer@0.1.0 test
> vitest run


 RUN  v2.1.9 /home/user/projects/codex-session-viewer

6:15:04 PM [vite] warning: This case clause will never be evaluated because it duplicates an earlier case clause
278|        return { type: 'Reasoning', content, id: base.id, at: base.at, index: base.index }
279|      }
280|      case 'function_call': {
   |           ^
281|        const name = asString((base as any).name) ?? asString((base as any).toolName) ?? 'function'
282|        const args = (base as any).args ?? (base as any).arguments

  Plugin: vite:esbuild
  File: /home/user/projects/codex-session-viewer/src/parser/validators.ts
6:15:04 PM [vite] warning: This case clause will never be evaluated because it duplicates an earlier case clause
285|        return { type: 'FunctionCall', name, args, durationMs, id: base.id, at: base.at, index: base.index }
286|      }
287|      case 'function_call_output': {
   |           ^
288|        const name = asString((base as any).name) ?? asString((base as any).toolName) ?? asString((base as any).call_id) ?? 'function'
289|        const raw = asString((base as any).output)

  Plugin: vite:esbuild
  File: /home/user/projects/codex-session-viewer/src/parser/validators.ts
 ✓ src/utils/__tests__/functionFiltersGeneric.test.ts (6 tests) 3ms
 ✓ src/parsers/__tests__/applyPatch.test.ts (3 tests) 3ms
 ✓ src/utils/__tests__/diff.test.ts (4 tests) 4ms
 ✓ src/parser/__tests__/streaming.test.ts (2 tests) 11ms
 ❯ src/parser/__tests__/foreignWrappers.test.ts (7 tests | 1 failed) 17ms
   × foreign wrappers and blanks > tolerates array-style NDJSON (brackets and trailing comma) 12ms
     → expected 4 to be 1 // Object.is equality
 ✓ src/utils/__tests__/functionFilters.test.ts (2 tests) 3ms
 ✓ src/parser/__tests__/lineReader.test.ts (3 tests) 8ms
 ✓ src/parser/__tests__/metaOptionalId.test.ts (2 tests) 12ms
 ✓ src/parser/__tests__/validators.test.ts (3 tests) 4ms
 ✓ src/components/__tests__/applyPatchView.test.ts (1 test) 16ms
 ✓ src/utils/__tests__/fileTree.test.ts (3 tests) 3ms
 ✓ src/export/__tests__/csv.test.ts (1 test) 2ms
 ✓ src/utils/timestamp.test.ts (5 tests) 2ms
 ✓ src/components/__tests__/diffTheme.test.ts (3 tests) 2ms
 ✓ src/scanner/__tests__/diffIndex.test.ts (1 test) 6ms
 ✓ src/components/__tests__/twoFileDiff.test.ts (1 test) 4ms
 ✓ src/utils/__tests__/hashState.test.ts (4 tests) 4ms
stderr | src/hooks/__tests__/useAutoDiscovery.test.ts > useAutoDiscovery > discovers project files and supports reload debounce
Warning: `ReactDOMTestUtils.act` is deprecated in favor of `React.act`. Import `act` from `react` instead of `react-dom/test-utils`. See https://react.dev/warnings/react-dom-test-utils for more info.
Warning: The current testing environment is not configured to support act(...)
Warning: The current testing environment is not configured to support act(...)
    at TestComp (/home/user/projects/codex-session-viewer/src/hooks/__tests__/useAutoDiscovery.test.ts:12:91)
Warning: The current testing environment is not configured to support act(...)
    at TestComp (/home/user/projects/codex-session-viewer/src/hooks/__tests__/useAutoDiscovery.test.ts:12:91)
Warning: The current testing environment is not configured to support act(...)
    at TestComp (/home/user/projects/codex-session-viewer/src/hooks/__tests__/useAutoDiscovery.test.ts:12:91)
Warning: The current testing environment is not configured to support act(...)
    at TestComp (/home/user/projects/codex-session-viewer/src/hooks/__tests__/useAutoDiscovery.test.ts:12:91)

 ✓ src/state/__tests__/theme.test.ts (2 tests) 3ms
stderr | src/utils/__tests__/logger.test.ts > logger > logError records into window.__csvErrors and posts
[ctx] Error: boom
    at /home/user/projects/codex-session-viewer/src/utils/__tests__/logger.test.ts:13:21
    at file:///home/user/projects/codex-session-viewer/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///home/user/projects/codex-session-viewer/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///home/user/projects/codex-session-viewer/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///home/user/projects/codex-session-viewer/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at runSuite (file:///home/user/projects/codex-session-viewer/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/user/projects/codex-session-viewer/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///home/user/projects/codex-session-viewer/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///home/user/projects/codex-session-viewer/node_modules/@vitest/runner/dist/index.js:1271:3) { a: 1 }

 ✓ src/utils/__tests__/logger.test.ts (2 tests) 5ms
stdout | src/utils/__tests__/logger.test.ts > logger > logInfo posts payload
[ctx] hello undefined

stderr | src/hooks/__tests__/useAutoDiscovery.test.ts > useAutoDiscovery > discovers project files and supports reload debounce
Warning: The current testing environment is not configured to support act(...)
Warning: The current testing environment is not configured to support act(...)
Warning: The current testing environment is not configured to support act(...)
Warning: The current testing environment is not configured to support act(...)

 ✓ src/hooks/__tests__/useAutoDiscovery.test.ts (1 test) 456ms
   ✓ useAutoDiscovery > discovers project files and supports reload debounce 455ms

⎯⎯⎯⎯⎯⎯⎯ Failed Tests 1 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  src/parser/__tests__/foreignWrappers.test.ts > foreign wrappers and blanks > tolerates array-style NDJSON (brackets and trailing comma)
AssertionError: expected 4 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 4

 ❯ src/parser/__tests__/foreignWrappers.test.ts:40:39
     38|       if (it.kind === 'event') events++
     39|       if (it.kind === 'done') {
     40|         expect(it.stats.parsedEvents).toBe(1)
       |                                       ^
     41|         done = true
     42|       }

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/1]⎯

 Test Files  1 failed | 19 passed (20)
      Tests  1 failed | 55 passed (56)
   Start at  18:15:04
   Duration  1.61s (transform 380ms, setup 0ms, collect 829ms, tests 566ms, environment 1.21s, prepare 916ms)

